# plot_runlog_epochs0_99.py
# Dependencies: pandas, matplotlib, seaborn, numpy
# Example: python plot_runlog_epochs0_99.py

import json
import pandas as pd
import matplotlib.pyplot as plt
import seaborn as sns
import numpy as np

# --- Dữ liệu đã trích xuất (epochs 0..99) ---
data = {
  "epoch": [
    0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99
  ],
  "lr": [
    0.025,0.02499846,0.02499383,0.02498613,0.02497534,0.02496148,0.02494455,0.02492454,0.02490147,0.02487535,0.02484617,0.02481394,0.02477868,0.02474039,0.02469908,0.02465476,0.02460745,0.02455714,0.02450387,0.02444763,0.02438845,0.02432634,0.02426131,0.02419337,0.02412256,0.02404887,0.02397234,0.02389298,0.02381081,0.02372585,0.02363813,0.02354765,0.02345445,0.02335855,0.02325997,0.02315874,0.02305488,0.02294841,0.02283937,0.02272778,0.02261367,0.02249706,0.02237799,0.02225648,0.02213256,0.02200627,0.02187764,0.02174669,0.02161346,0.02147799,0.0213403,0.02120043,0.02105842,0.02091429,0.02076809,0.02061985,0.02046961,0.02031741,0.02016327,0.02000725,0.01984938,0.01968969,0.01952823,0.01936504,0.01920016,0.01903362,0.01886547,0.01869576,0.01852451,0.01835178,0.01817761,0.01800204,0.01782511,0.01764687,0.01746736,0.01728663,0.01710472,0.01692167,0.01673753,0.01655235,0.01636617,0.01617903,0.01599099,0.01580209,0.01561238,0.0154219,0.0152307,0.01503883,0.01484633,0.01465325,0.01445965,0.01426556,0.01407104,0.01387613,0.01368088,0.01348535,0.01328957,0.0130936,0.01289748,0.01270126
  ],
  "WeightLoss": [
    1.751,1.13,1.033,1.01,1.006,1.005,1.028,0.973,0.957,0.96,0.936,0.921,0.948,0.96,0.94,0.925,0.893,0.881,0.903,0.915,0.897,0.903,0.877,0.872,0.862,0.877,0.868,0.863,0.877,0.856,0.855,0.849,0.834,0.829,0.833,0.831,0.815,0.837,0.842,0.846,0.844,0.825,0.853,0.878,0.902,0.888,0.867,0.94,0.921,1.005,1.016,0.979,1.12,1.052,1.069,1.145,1.415,1.18,1.282,1.047,0.999,1.032,0.962,1.042,1.11,0.934,0.98,1.011,0.892,0.978,1.014,0.901,0.855,0.886,0.873,0.883,0.844,0.872,0.708,0.722,0.702,0.703,0.699,0.689,0.707,0.706,0.695,0.672,0.683,0.682,0.697,0.701,0.678,0.681,0.673,0.673,0.682,0.679,0.662,0.666
  ],
  "ArchLoss": [
    0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,1.248,1.084,0.99,0.978,0.93,0.905,0.891,0.868,0.84,0.834,0.812,0.791,0.783,0.771,0.758,0.74,0.75,0.751,0.764,0.753,0.773,0.795,0.771,0.772,0.783,0.782,0.795,0.798,0.799,0.834,0.828,0.806,0.802,0.847,0.869,0.898,0.881,0.846,0.933,0.897,0.889,0.976,0.953,0.964,0.965,0.952,0.951,0.942,0.941,0.943,0.947,0.947,0.939,0.924,0.953,0.908,0.92,0.894,0.912,0.924,0.911,0.885,0.909,0.869,0.873,0.868,0.88,0.876,0.892,0.895,0.893,0.898,0.901,0.904,0.921,0.916,0.921,0.93,0.937,0.937,0.942,0.936,0.939,0.953,0.953
  ],
  "Acc": [
    0.862,0.911,0.909,0.911,0.907,0.911,0.912,0.912,0.91,0.915,0.913,0.913,0.914,0.909,0.919,0.919,0.923,0.923,0.918,0.924,0.926,0.925,0.928,0.926,0.93,0.929,0.93,0.928,0.932,0.922,0.931,0.93,0.933,0.933,0.934,0.934,0.934,0.933,0.933,0.933,0.932,0.936,0.935,0.938,0.931,0.934,0.934,0.935,0.935,0.938,0.937,0.933,0.94,0.94,0.937,0.939,0.942,0.939,0.939,0.939,0.94,0.941,0.94,0.941,0.94,0.942,0.938,0.943,0.942,0.942,0.945,0.945,0.943,0.946,0.945,0.941,0.945,0.943,0.946,0.946,0.947,0.946,0.947,0.948,0.949,0.946,0.947,0.948,0.947,0.947,0.947,0.946,0.951,0.948,0.95,0.95,0.949,0.949,0.95,0.95
  ],
  "Dice": [
    0.045,0.009,0.017,0.027,0.02,0.024,0.015,0.121,0.105,0.169,0.146,0.153,0.21,0.161,0.236,0.258,0.286,0.278,0.206,0.275,0.313,0.288,0.343,0.348,0.351,0.352,0.389,0.377,0.375,0.311,0.408,0.415,0.422,0.415,0.422,0.409,0.438,0.375,0.401,0.409,0.429,0.422,0.437,0.436,0.445,0.397,0.399,0.451,0.456,0.451,0.462,0.427,0.469,0.469,0.462,0.456,0.49,0.483,0.477,0.491,0.483,0.519,0.481,0.494,0.514,0.495,0.501,0.534,0.525,0.55,0.557,0.572,0.523,0.556,0.554,0.541,0.573,0.575,0.577,0.56,0.578,0.571,0.572,0.588,0.601,0.58,0.594,0.597,0.594,0.612,0.597,0.609,0.637,0.635,0.634,0.638,0.623,0.644,0.638,0.625
  ],
  "Jc": [
    0.025,0.005,0.01,0.015,0.011,0.013,0.008,0.076,0.067,0.11,0.092,0.101,0.139,0.103,0.161,0.173,0.193,0.191,0.143,0.191,0.215,0.203,0.239,0.245,0.252,0.247,0.281,0.269,0.273,0.218,0.295,0.3,0.306,0.303,0.304,0.302,0.321,0.274,0.301,0.302,0.31,0.317,0.322,0.328,0.33,0.294,0.293,0.334,0.345,0.342,0.349,0.312,0.356,0.359,0.35,0.346,0.379,0.367,0.36,0.37,0.369,0.398,0.372,0.377,0.393,0.383,0.378,0.414,0.407,0.416,0.43,0.447,0.405,0.437,0.439,0.412,0.445,0.444,0.452,0.434,0.455,0.444,0.444,0.462,0.478,0.452,0.466,0.465,0.467,0.479,0.462,0.482,0.505,0.507,0.503,0.511,0.49,0.513,0.508,0.499
  ],
  "ComplexityLoss": [
    0.5406,0.5406,0.5406,0.5406,0.5406,0.5406,0.5406,0.5406,0.5406,0.5406,0.5406,0.5406,0.5406,0.5406,0.5406,0.532,0.5153,0.4998,0.4861,0.4752,0.4666,0.46,0.4553,0.4524,0.4513,0.4475,0.4444,0.4423,0.4407,0.4407,0.4418,0.4392,0.4371,0.4347,0.4324,0.4303,0.4275,0.425,0.4221,0.4197,0.4169,0.4146,0.4121,0.4099,0.4087,0.408,0.4072,0.4063,0.4051,0.4044,0.4038,0.4036,0.403,0.4023,0.4018,0.4011,0.4,0.3997,0.3993,0.3991,0.3989,0.3987,0.3985,0.3986,0.3986,0.3985,0.3984,0.3985,0.3984,0.3983,0.3983,0.3985,0.3987,0.3989,0.399,0.399,0.3993,0.3992,0.3994,0.3995,0.3996,0.3996,0.3994,0.3994,0.3995,0.3995,0.3995,0.3993,0.3993,0.3992,0.3992,0.3992,0.3991,0.3988,0.3986,0.3985,0.3982,0.3981,0.398,0.3977
  ],
  "ArchComplexityLoss": [
    0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,1.1824,1.1952,1.2019,1.2039,1.2042,1.2039,1.2027,1.1999,1.1926,1.1793,1.1902,1.2003,1.2028,1.2039,1.1958,1.1831,1.2001,1.2125,1.2249,1.2361,1.2469,1.2571,1.2653,1.2732,1.2813,1.2885,1.2964,1.3033,1.3114,1.3227,1.334,1.3442,1.3542,1.3663,1.3778,1.3889,1.3987,1.4085,1.421,1.4306,1.4394,1.453,1.4609,1.4713,1.4815,1.493,1.5035,1.5143,1.5258,1.5368,1.5493,1.5607,1.5698,1.5833,1.5953,1.6061,1.6176,1.6302,1.6404,1.6527,1.6649,1.6745,1.6871,1.6949,1.7066,1.7201,1.7336,1.7462,1.7591,1.7716,1.7845,1.7961,1.8076,1.8213,1.8334,1.8452,1.8562,1.8684,1.8799,1.8921,1.9028,1.914,1.9248,1.9366,1.9474
  ],
  "TransformerLoss": [
    0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,2.8621,2.3198,1.8201,1.6632,1.5682,1.4654,1.3592,1.2478,1.1371,1.0258,0.9196,0.8272,0.7476,0.6808,0.6234,0.6126,0.6135,0.6114,0.6107,0.6092,0.6076,0.6073,0.6048,0.6034,0.6024,0.6021,0.6015,0.6011,0.5998,0.6016,0.5999,0.5975,0.596,0.5991,0.6004,0.6001,0.5967,0.5951,0.5995,0.5966,0.596,0.6043,0.599,0.5984,0.5978,0.5958,0.595,0.5939,0.5937,0.5928,0.5934,0.5946,0.5906,0.5891,0.5891,0.5895,0.5906,0.5905,0.5896,0.5905,0.5904,0.5886,0.5903,0.5858,0.5858,0.5860,0.5870,0.5869,0.5873,0.5878,0.5881,0.5873,0.5869,0.5870,0.5879,0.5869,0.5868,0.5875,0.5874,0.5881,0.5885,0.5880,0.5882,0.5890,0.5887
  ]
}

# --- Build DataFrame ---
df = pd.DataFrame(data)
df.set_index('epoch', inplace=False)

# small helper for smoothing (optional)
def smooth(series, window=3):
    try:
        return series.rolling(window, min_periods=1, center=True).mean()
    except Exception:
        return series

# --- Plotting style ---
sns.set(style='whitegrid', context='talk', rc={'figure.figsize':(14,10)})

# 1) Losses: WeightLoss & ArchLoss, with lr on secondary axis
fig, ax1 = plt.subplots()
ax1.plot(df['epoch'], df['WeightLoss'], label='WeightLoss', color='C0', marker='o', markersize=4)
ax1.plot(df['epoch'], df['ArchLoss'], label='ArchLoss', color='C1', linestyle='--', marker='o', markersize=4)
ax1.set_xlabel('Epoch')
ax1.set_ylabel('Loss')
ax1.legend(loc='upper left')
ax1.set_title('Training Losses and Learning Rate')

ax2 = ax1.twinx()
ax2.plot(df['epoch'], df['lr'], label='lr', color='C3', alpha=0.6)
ax2.set_ylabel('Learning rate')
ax2.legend(loc='upper right')
plt.tight_layout()
plt.savefig('losses_lr_epoch0_99.png', dpi=150)

# 2) Dice & Jaccard (Jc)
plt.figure()
plt.plot(df['epoch'], df['Dice'], label='Dice', color='C2', marker='o', markersize=4)
plt.plot(df['epoch'], df['Jc'], label='Jaccard (Jc)', color='C4', linestyle='--', marker='o', markersize=4)
plt.xlabel('Epoch')
plt.ylabel('Score')
plt.title('Dice and Jaccard (Jc) over Epochs 0-99')
plt.legend()
plt.grid(True)
plt.tight_layout()
plt.savefig('dice_jc_epoch0_99.png', dpi=150)

# 3) Accuracy
plt.figure()
plt.plot(df['epoch'], df['Acc'], label='Accuracy', color='C5', marker='o')
plt.xlabel('Epoch')
plt.ylabel('Accuracy')
plt.title('Training Accuracy over Epochs 0-99')
plt.ylim(0,1.02)
plt.grid(True)
plt.legend()
plt.tight_layout()
plt.savefig('acc_epoch0_99.png', dpi=150)

# 4) ComplexityLoss, ArchComplexityLoss, TransformerLoss
plt.figure()
plt.plot(df['epoch'], df['ComplexityLoss'], label='ComplexityLoss', color='C6', marker='o', markersize=3)
plt.plot(df['epoch'], df['ArchComplexityLoss'], label='ArchComplexityLoss', color='C7', marker='o', markersize=3)
plt.plot(df['epoch'], df['TransformerLoss'], label='TransformerLoss', color='C8', marker='o', markersize=3)
plt.xlabel('Epoch')
plt.ylabel('Value')
plt.title('Complexity & Transformer Losses over Epochs 0-99')
plt.legend()
plt.grid(True)
plt.tight_layout()
plt.savefig('complexity_transformer_epoch0_99.png', dpi=150)

# 5) Optional: rolling-smoothed Dice curve for trend
plt.figure()
plt.plot(df['epoch'], df['Dice'], alpha=0.25, label='Dice (raw)')
plt.plot(df['epoch'], smooth(pd.Series(df['Dice']), window=7), color='C2', label='Dice (smoothed, w=7)')
plt.xlabel('Epoch')
plt.ylabel('Dice')
plt.title('Dice raw vs smoothed (window=7)')
plt.legend()
plt.grid(True)
plt.tight_layout()
plt.savefig('dice_smoothed_epoch0_99.png', dpi=150)

print('Saved plots: losses_lr_epoch0_99.png, dice_jc_epoch0_99.png, acc_epoch0_99.png, complexity_transformer_epoch0_99.png, dice_smoothed_epoch0_99.png')
plt.show()